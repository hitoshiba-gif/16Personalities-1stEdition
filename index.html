<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>16BodyPersonalities</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="WAVE"> <!-- â†ã“ã“ã§ãƒ†ãƒ¼ãƒåˆ‡æ›¿ï¼ˆWAVE/NATURAL/STRAIGHTï¼‰ -->
  <header class="site-header">
  <a class="brand" href="index.html">16Body<span>Personalities</span></a>

  <!-- PCè¡¨ç¤ºï¼šå³ä¸Šã«ä¸¦ã¶ -->
  <nav class="nav-links">
    <a href="index.html" class="chip-btn">ãƒˆãƒƒãƒ—</a>
    <a href="gallery.html" class="chip-btn">ã‚¿ã‚¤ãƒ—ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
    <a href="contact.html" class="chip-btn">ãŠå•ã„åˆã‚ã›</a>
  </nav>

  <!-- ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºï¼šãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ -->
  <button class="hamburger" id="navOpen" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼" aria-controls="drawer" aria-expanded="false">
    <!-- 3æœ¬ç·šã‚¢ã‚¤ã‚³ãƒ³ï¼ˆSVGï¼‰ -->
    <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
</header>

<!-- ãƒ‰ãƒ­ãƒ¯ãƒ¼æœ¬ä½“ -->
<aside class="drawer" id="drawer" aria-hidden="true">
  <div class="drawer-head">
    <span class="drawer-brand">16BodyPersonalities</span>
    <button class="drawer-close" id="navClose" aria-label="é–‰ã˜ã‚‹">
      <svg width="26" height="26" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <nav class="drawer-links">
    <a href="index.html" class="drawer-item">ãƒˆãƒƒãƒ—</a>
    <a href="app.html" class="drawer-item">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</a>
    <a href="gallery.html" class="drawer-item">ã‚¿ã‚¤ãƒ—ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
    <a href="privacy.html" class="drawer-item">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</a>
    <a href="terms.html" class="drawer-item">åˆ©ç”¨è¦ç´„</a>
    <a href="contact.html" class="drawer-item">ãŠå•ã„åˆã‚ã›</a>
  </nav>
</aside>

<!-- åŠé€æ˜ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div class="scrim" id="scrim" hidden></div>
<div class="topbar-spacer"></div> <!-- ãƒŠãƒ“ã®é«˜ã•ã¶ã‚“ä½™ç™½ï¼ˆé‡ãªã‚Šé˜²æ­¢ï¼‰ -->
    <header>
      <span class="badge">1st Edition</span>
      <h1>16BodyPersonalities</h1>
    </header>

    <!-- ===== ã‚«ãƒ¼ãƒ‰1ï¼šã‚¤ãƒ³ãƒˆãƒ­ ===== -->
    <section class="card hero-card hero-cute">
  <div class="hero-bg">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <div class="hero-inner">
    <div class="badge-row">
      <span class="soft-badge accent">1st Edition</span>
    </div>

    <h2 class="hero-title">
      ã‚ãªãŸã®<span class="sparkle">Body</span> Personalities ã‚’è¨ºæ–­
    </h2>
    <p class="muted">16ã‚¿ã‚¤ãƒ—ã®éª¨æ ¼è¨ºæ–­ã§ã€è‡ªåˆ†ã®æ§‹é€ ã‚’çŸ¥ã‚ã†ã€‚</p>

    <div class="controls cute-cta">
      <button class="btn-cta" onclick="location.href='app.html'">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
      <button class="btn-ghost" onclick="location.href='gallery.html'">ã‚¿ã‚¤ãƒ—ã‚’è¦‹ã‚‹</button>
    </div>

    <!-- ç´°ã„çµµæ–‡å­—ãƒªãƒœãƒ³ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰-->
    <div class="emoji-ribbon full" id="emojiRibbon" aria-hidden="true">
  <div class="ribbon-track" id="ribbonTrack">
    <span class="loop">ğŸ¨ ğŸº ğŸ¦‹ ğŸ¹ ğŸ•Š ğŸ» ğŸ¦„ ğŸ¦… ğŸ¦Š ğŸ¦Œ ğŸ† ğŸ¦ˆ ğŸ… ğŸ¦š ğŸ¬ ğŸ¦‰</span>
  </div>
</div>
  </div>
</section>

   <section class="card" style="margin-top:12px;">
  <h3>ã‚¿ã‚¤ãƒ—å‰²åˆï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰</h3>
  <p class="muted small">å„éª¨æ ¼ã®åˆ†å¸ƒå‰²åˆãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¦‹ã‚Œã¡ã‚ƒã†ï¼</p>

  <!-- 3ãƒ™ãƒ¼ã‚¹ã®ãƒ‰ãƒ¼ãƒŠãƒ„ -->
  <div class="donut-row">
    <div class="donut-card" data-base="WAVE" style="position:relative;padding:8px;border:1px solid var(--border,#ddd);border-radius:12px;">
      <div class="donut" data-key="WAVE" style="width:140px;height:140px;margin:0 auto;position:relative;">
        <svg viewBox="0 0 120 120" class="ring" style="width:100%;height:100%;">
          <circle cx="60" cy="60" r="48" class="track" style="fill:none;stroke:#eee;stroke-width:16;"></circle>
          <circle cx="60" cy="60" r="48" class="prog" data-prog style="fill:none;stroke:currentColor;stroke-width:16;stroke-linecap:round;transform:rotate(-90deg);transform-origin:50% 50%;stroke-dasharray:0 999;"></circle>
        </svg>
        <div class="donut-center" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;">
          <div class="donut-title" style="font-weight:700;">WAVE</div>
          <div class="donut-num" data-num="WAVE" style="font-size:18px;">0%</div>
        </div>
      </div>
    </div>

    <!-- NATURAL -->
    <div class="donut-card" data-base="NATURAL" style="position:relative;padding:8px;border:1px solid var(--border,#ddd);border-radius:12px;">
      <div class="donut" data-key="NATURAL" style="width:140px;height:140px;margin:0 auto;position:relative;">
        <svg viewBox="0 0 120 120" class="ring" style="width:100%;height:100%;">
          <circle cx="60" cy="60" r="48" class="track" style="fill:none;stroke:#eee;stroke-width:16;"></circle>
          <circle cx="60" cy="60" r="48" class="prog" data-prog style="fill:none;stroke:currentColor;stroke-width:16;stroke-linecap:round;transform:rotate(-90deg);transform-origin:50% 50%;stroke-dasharray:0 999;"></circle>
        </svg>
        <div class="donut-center" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;">
          <div class="donut-title" style="font-weight:700;">NATURAL</div>
          <div class="donut-num" data-num="NATURAL" style="font-size:18px;">0%</div>
        </div>
      </div>
    </div>

    <!-- STRAIGHT -->
    <div class="donut-card" data-base="STRAIGHT" style="position:relative;padding:8px;border:1px solid var(--border,#ddd);border-radius:12px;">
      <div class="donut" data-key="STRAIGHT" style="width:140px;height:140px;margin:0 auto;position:relative;">
        <svg viewBox="0 0 120 120" class="ring" style="width:100%;height:100%;">
          <circle cx="60" cy="60" r="48" class="track" style="fill:none;stroke:#eee;stroke-width:16;"></circle>
          <circle cx="60" cy="60" r="48" class="prog" data-prog style="fill:none;stroke:currentColor;stroke-width:16;stroke-linecap:round;transform:rotate(-90deg);transform-origin:50% 50%;stroke-dasharray:0 999;"></circle>
        </svg>
        <div class="donut-center" style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;">
          <div class="donut-title" style="font-weight:700;">STRAIGHT</div>
          <div class="donut-num" data-num="STRAIGHT" style="font-size:18px;">0%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 16ã‚¿ã‚¤ãƒ—ã®è¡¨ -->
  <h3 style="margin:0 0 6px;">16ã‚¿ã‚¤ãƒ—å­˜åœ¨å‰²åˆ</h3>
  <div class="type-grid" id="typeGridTop"></div>
</section>

    <!-- ===== ã‚«ãƒ¼ãƒ‰2ï¼šç‰¹å¾´èª¬æ˜ ===== -->
    <section class="card">
      <h3>ã“ã®è¨ºæ–­ã®ç‰¹å¾´</h3>
      <ul>
        <li>éª¨æ ¼ã®ç‰¹å¾´ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ / ã‚¦ã‚§ãƒ¼ãƒ– / ãƒŠãƒãƒ¥ãƒ©ãƒ«ï¼‰ã‚’ã‚‚ã¨ã«æ›´ã«16ã‚¿ã‚¤ãƒ—ã«åˆ†æï¼</li>
        <li>ã“ã‚Œã¾ã§ãªã‹ã£ãŸæ·±åº¦ã§16ã‚¿ã‚¤ãƒ—ã‚’å°å‡ºï¼</li>
        <li>ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ãƒ»å°è±¡å‚¾å‘ã‚’ãƒˆãƒ¼ã‚¿ãƒ«ã§æç¤ºï¼</li>
      </ul>
    </section>

    <!-- ===== ã‚«ãƒ¼ãƒ‰3ï¼šã‚®ãƒ£ãƒ©ãƒªãƒ¼ or çµæœä¸€è¦§ ===== -->
   <!-- ===== ã‚«ãƒ¼ãƒ‰3ï¼šã‚®ãƒ£ãƒ©ãƒªãƒ¼å°ç·š ===== -->

    <footer class="footer">
      <span class="small">Â© 2025 16BodyPersonalities Project</span>
      <span>
    <a class="muted" href="terms.html">Terms</a> ãƒ»
    <a class="muted" href="privacy.html">Privacy</a>
  </span>
</footer>
    </footer>
  </div>
  
  <script>
/* ==== GASã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ==== */
const GAS_URL = "https://script.google.com/macros/s/AKfycbxb93EpsZ6S0Xizk9PdBEJC8stOJtYLgJA4X92m_9Q2tulQRgSunmk-xdxIHevIC15d/exec";

/* ==== 16ã‚¿ã‚¤ãƒ—ï¼ˆè»½é‡ãƒ¡ã‚¿ï¼‰ ==== */
const CODE_META = {
  BNLS:{emoji:'ğŸ¨', label:'éª¨æ ¼ã‚³ã‚¢ãƒ©'},    MNLC:{emoji:'ğŸº', label:'éª¨æ ¼ã‚¦ãƒ«ãƒ•'},
  MWLC:{emoji:'ğŸ¦‹', label:'éª¨æ ¼ãƒã‚¿ãƒ•ãƒ©ã‚¤'}, MWLS:{emoji:'ğŸ¹', label:'éª¨æ ¼ãƒãƒ ã‚¹ã‚¿ãƒ¼'},
  MNLS:{emoji:'ğŸ•Š', label:'éª¨æ ¼ãƒ‰ãƒ¼ãƒ–'},     BNLC:{emoji:'ğŸ»', label:'éª¨æ ¼ãƒ†ãƒ‡ã‚£'},
  BWUC:{emoji:'ğŸ¦„', label:'éª¨æ ¼ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³'},  BWUS:{emoji:'ğŸ¦…', label:'éª¨æ ¼ã‚¤ãƒ¼ã‚°ãƒ«'},
  BWLC:{emoji:'ğŸ¦Š', label:'éª¨æ ¼ãƒ•ã‚©ãƒƒã‚¯ã‚¹'},  BWLS:{emoji:'ğŸ¦Œ', label:'éª¨æ ¼ãƒãƒ³ãƒ“'},
  BNUS:{emoji:'ğŸ†', label:'éª¨æ ¼ãƒ‘ãƒ³ã‚µãƒ¼'},    MWUC:{emoji:'ğŸ¦ˆ', label:'éª¨æ ¼ã‚·ãƒ£ãƒ¼ã‚¯'},
  MNUC:{emoji:'ğŸ…', label:'éª¨æ ¼ã‚¿ã‚¤ã‚¬ãƒ¼'},    MNUS:{emoji:'ğŸ¦š', label:'éª¨æ ¼ãƒ”ãƒ¼ã‚³ãƒƒã‚¯'},
  MWUS:{emoji:'ğŸ¬', label:'éª¨æ ¼ãƒ‰ãƒ«ãƒ•ã‚£ãƒ³'},  BNUC:{emoji:'ğŸ¦‰', label:'éª¨æ ¼ã‚ªã‚¦ãƒ«'},
};
const ALL_CODES = Object.keys(CODE_META);


/* 16ã‚¿ã‚¤ãƒ—ã®å‹•ç‰©çµµæ–‡å­— */
const EMOJIS_16 = [
  'ğŸ¨','ğŸº','ğŸ¦‹','ğŸ¹','ğŸ•Š','ğŸ»','ğŸ¦„','ğŸ¦…',
  'ğŸ¦Š','ğŸ¦Œ','ğŸ†','ğŸ¦ˆ','ğŸ…','ğŸ¦š','ğŸ¬','ğŸ¦‰'
];

(function makeEmojiCloud() {
  const host = document.querySelector('.emoji-cloud');
  if (!host) return;

  const N = 18; // ç²’ã®æ•°ï¼ˆå°‘ã—å¤šã‚ãŒå¯æ„›ã„ï¼‰
  const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
  const isMobile = vw < 480;

  for (let i = 0; i < N; i++) {
    const span = document.createElement('span');
    span.className = 'emo';
    span.textContent = EMOJIS_16[i % EMOJIS_16.length];

    const size   = isMobile ? rand(18, 28)  : rand(22, 34);
    const x      = rand(6, 94);      // æ¨ªä½ç½® %
    const yStart = rand(102, 120);   // ç”»é¢ä¸‹ã‹ã‚‰
    const dur    = rand(10, 16);     // æµ®éŠæ™‚é–“
    const delay  = rand(-8, 6);      // ãšã‚‰ã—
    const drift  = rand(14, 28);     // å·¦å³ã‚†ã‚‰ã
    const rot    = rand(6, 14) * (Math.random() < .5 ? -1 : 1);
    const travel = isMobile ? rand(48, 60) : rand(55, 70); // ä¸Šæ˜‡è·é›¢ï¼ˆvhï¼‰
    const opacity= rand(55, 80) / 100;

    span.style.setProperty('--size', size);
    span.style.setProperty('--x', x);
    span.style.setProperty('--yStart', yStart);
    span.style.setProperty('--dur', dur + 's');
    span.style.setProperty('--delay', delay + 's');
    span.style.setProperty('--drift', drift + 'px');
    span.style.setProperty('--rot', rot + 'deg');
    span.style.setProperty('--heightTravel', travel + 'vh');
    span.style.setProperty('--opacity', opacity);

    host.appendChild(span);
  }

  function rand(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
})();
</script>
<script>
  (function(){
    const ribbon = document.getElementById('emojiRibbon');
    const track  = document.getElementById('ribbonTrack');
    if(!ribbon || !track) return;

    const durSec = Number(ribbon.dataset.speed || 28);
    track.style.setProperty('--dur', durSec + 's');

    const base = track.querySelector('.loop');
    if(!base) return;

    const needWidth = () => ribbon.clientWidth * 2.2;
    while (track.scrollWidth < needWidth()) {
      track.appendChild(base.cloneNode(true));
    }
    track.appendChild(base.cloneNode(true));

    const half = track.scrollWidth / 2;
    const gap  = Math.max(0, half - ribbon.clientWidth);
    const ratio = half ? (gap / half) : 0;
    const delaySec = -(ratio * durSec);
    track.style.setProperty('--delay', delaySec + 's');

    requestAnimationFrame(()=> track.classList.add('is-ready'));

    let t;
    window.addEventListener('resize', ()=>{
      clearTimeout(t);
      t = setTimeout(()=>{
        track.innerHTML = '';
        track.appendChild(base.cloneNode(true));
        (function rebuild(){
          while (track.scrollWidth < needWidth()) track.appendChild(base.cloneNode(true));
          track.appendChild(base.cloneNode(true));
          const half = track.scrollWidth / 2;
          const gap  = Math.max(0, half - ribbon.clientWidth);
          const ratio = half ? (gap / half) : 0;
          const delaySec = -(ratio * durSec);
          track.style.setProperty('--delay', delaySec + 's');
          track.classList.add('is-ready');
        })();
      }, 120);
    }, { passive:true });
  })();

/* ==== ãƒ¡ã‚¤ãƒ³æç”» ==== */
async function fetchStats(){
  const url = GAS_URL + '?stats=1';
  const res = { total:0, byType:{}, byBase:{WAVE:0,NATURAL:0,STRAIGHT:0} };
  try{
    const r = await fetch(url, { cache:'no-store' });
    if (!r.ok) return res;
    const data = await r.json();
    res.total  = data.total  || 0;
    res.byType = data.byType || {};
    res.byBase = data.byBase || { WAVE:0, NATURAL:0, STRAIGHT:0 };
  }catch(e){
    console.warn('[index] fetch stats error:', e);
  }
  return res;
}

function renderDonut(base, count, total){
  const donut = document.querySelector(`.donut[data-key="${base}"]`);
  const numEl = document.querySelector(`.donut-num[data-num="${base}"]`);
  if (!donut || !numEl) return;

  const pct = total ? Math.round((count/total)*100) : 0;
  numEl.textContent = pct + '%';

  const C = 2 * Math.PI * 48; // r=48
  const dash = (pct/100) * C;
  const prog = donut.querySelector('[data-prog]');
  if (prog) prog.style.strokeDasharray = `${dash} ${C-dash}`;
}

function renderTypeGridTop(byType, total){
  const host = document.getElementById('typeGridTop'); // â† ã“ã“ãŒä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ˆIDä¸€è‡´ï¼‰
  if (!host) return;

  const max = Math.max(...ALL_CODES.map(c => byType[c] || 0), 1);
  host.innerHTML = ALL_CODES.map(code=>{
    const n   = byType[code] || 0;
    const pct = total ? Math.round(n / total * 100) : 0;
    const w   = Math.max(3, Math.round((n / max) * 100));
    const {emoji, label} = CODE_META[code] || {emoji:'ğŸ§­', label:code};
    return `
      <div class="type-cell" data-code="${code}" title="${code}">
        <div class="type-ico">${emoji}</div>
        <div class="type-meta">
          <div class="type-name">${label} <span class="muted">(${code})</span></div>
          <div class="type-bar"><i style="width:${w}%"></i></div>
          <div class="small muted" style="margin-top:4px">${pct}% ãƒ» ${n}ä»¶</div>
        </div>
      </div>`;
  }).join('');
}

async function renderIndex(){
  const stats = await fetchStats();
  // ãƒ‰ãƒ¼ãƒŠãƒ„ï¼ˆ3ãƒ™ãƒ¼ã‚¹ï¼‰
  renderDonut('WAVE',     stats.byBase.WAVE||0,     stats.total||0);
  renderDonut('NATURAL',  stats.byBase.NATURAL||0,  stats.total||0);
  renderDonut('STRAIGHT', stats.byBase.STRAIGHT||0, stats.total||0);

  // 16ã‚¿ã‚¤ãƒ—è¡¨
  renderTypeGridTop(stats.byType||{}, stats.total||0);
}

document.addEventListener('DOMContentLoaded', ()=>{
  renderIndex();
  setInterval(renderIndex, 60000); // ä»»æ„
});
</script>
<script>
window.addEventListener('DOMContentLoaded', function(){
  const openBtn  = document.getElementById('navOpen');
  const closeBtn = document.getElementById('navClose');
  const drawer   = document.getElementById('drawer');
  const scrim    = document.getElementById('scrim');

  if(!openBtn || !closeBtn || !drawer || !scrim){
    console.warn('[drawer] å¿…è¦ãªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    return;
  }

  function open(){
    drawer.classList.add('open');
    drawer.setAttribute('aria-hidden','false');
    openBtn.setAttribute('aria-expanded','true');
    scrim.hidden = false;
    document.documentElement.style.overflow = 'hidden'; // èƒŒæ™¯å›ºå®š
  }
  function close(){
    drawer.classList.remove('open');
    drawer.setAttribute('aria-hidden','true');
    openBtn.setAttribute('aria-expanded','false');
    scrim.hidden = true;
    document.documentElement.style.overflow = '';
  }

  openBtn.addEventListener('click', open,  { passive: true });
  closeBtn.addEventListener('click', close, { passive: true });
  scrim.addEventListener('click', close,    { passive: true });
  window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });
});
</script>
<script>
(function(){
  const ribbon = document.getElementById('emojiRibbon');
  const track  = document.getElementById('ribbonTrack');
  if(!ribbon || !track) return;

  // é€Ÿåº¦ï¼ˆç§’ï¼‰ã‚’ã‚«ã‚¹ã‚¿ãƒ ã—ãŸã„å ´åˆã¯ data-speed="26" ãªã©ã‚’emojiRibbonã«ä»˜ã‘ã‚‹
  const durSec = Number(ribbon.dataset.speed || 28);
  track.style.setProperty('--dur', durSec + 's');

  // åŸºæœ¬ãƒ«ãƒ¼ãƒ—ï¼ˆ1å€‹ç›®ï¼‰ã‚’å–å¾—
  const base = track.querySelector('.loop');
  if(!base) return;

  // ç”»é¢å¹…ã«å¿œã˜ã¦ã€ãƒˆãƒ©ãƒƒã‚¯å¹…ãŒã€Œã‚³ãƒ³ãƒ†ãƒŠå¹…ã®2.2å€ä»¥ä¸Šã€ã«ãªã‚‹ã¾ã§è¤‡è£½
  const needWidth = () => ribbon.clientWidth * 2.2;
  while (track.scrollWidth < needWidth()) {
    track.appendChild(base.cloneNode(true));
  }
  // å¿µã®ãŸã‚ã‚‚ã†1ã¤è¿½åŠ ï¼ˆç¶™ãç›®ã®å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ï¼‰
  track.appendChild(base.cloneNode(true));

  // å³ç«¯ã‹ã‚‰è‡ªç„¶ã«ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®ã€Œè² ã®ãƒ‡ã‚£ãƒ¬ã‚¤ã€ã‚’ç®—å‡º
  // åŠåˆ†ï¼ˆ=ãƒ«ãƒ¼ãƒ—1å‘¨æœŸã¶ã‚“ï¼‰ã®å¹…ã«å¯¾ã—ã€ã„ã¾å¯è¦–å¹…ã‚’åŸ‹ã‚ã‚‹ãŸã‚ã®å·®ã‚’æ¯”ã§å‡ºã™
  const half = track.scrollWidth / 2;
  const gap  = Math.max(0, half - ribbon.clientWidth);          // å³å´ã®â€œä½™ã‚Šâ€
  const ratio = half ? (gap / half) : 0;                        // 0ã€œ1
  const delaySec = -(ratio * durSec);                           // è² ã®ãƒ‡ã‚£ãƒ¬ã‚¤
  track.style.setProperty('--delay', delaySec + 's');

  // æº–å‚™å®Œäº† â†’ ã‚¢ãƒ‹ãƒ¡é–‹å§‹
  requestAnimationFrame(()=> track.classList.add('is-ready'));

  // ãƒªã‚µã‚¤ã‚ºã§å†è¨ˆç®—ï¼ˆãƒ¢ãƒã‚¤ãƒ«å›è»¢ã«ã‚‚å¯¾å¿œï¼‰
  let t;
  window.addEventListener('resize', ()=>{
    clearTimeout(t);
    t = setTimeout(()=>{
      // ä¸€æ—¦åˆæœŸåŒ–ã—ã¦ã‹ã‚‰å†æ§‹ç¯‰
      track.innerHTML = '';
      track.appendChild(base.cloneNode(true));
      // å†å¸°çš„ã«è‡ªåˆ†ã‚’å‘¼ã¶ã®ã¯é¿ã‘ã€åŒã˜å‡¦ç†ã‚’é–¢æ•°åŒ–ã™ã‚‹ã®ãŒç†æƒ³ã ãŒçŸ­ã•å„ªå…ˆã§å†ãƒ­ãƒ¼ãƒ‰
      (function rebuild(){
        while (track.scrollWidth < needWidth()) track.appendChild(base.cloneNode(true));
        track.appendChild(base.cloneNode(true));
        const half = track.scrollWidth / 2;
        const gap  = Math.max(0, half - ribbon.clientWidth);
        const ratio = half ? (gap / half) : 0;
        const delaySec = -(ratio * durSec);
        track.style.setProperty('--delay', delaySec + 's');
        track.classList.add('is-ready');
      })();
    }, 120);
  }, { passive: true });
})();
</script>
</body>
</html>
